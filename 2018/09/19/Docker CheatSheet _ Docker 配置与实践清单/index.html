<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/bugs/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/bugs/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/bugs/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/bugs/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/bugs/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/bugs/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/bugs/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/bugs/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/bugs/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="docker," />










<meta name="description" content="æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://juejin.im/post/5ba11f635188255c8473a134?utm_source=gold_browser_extension   ğŸ“– èŠ‚é€‰è‡ª Awesome CheatSheet/Docker CheatSheetï¼Œå¯¹æ¥è‡ªå®˜æ–¹æ–‡æ¡£åŠ Docker Links ä¸­é“¾æ¥å†…å®¹çš„å½’æ¡£æ•´ç†ï¼ŒåŒ…å«äº†æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„ D">
<meta name="keywords" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker CheatSheet | Docker é…ç½®ä¸å®è·µ">
<meta property="og:url" content="https://deanwang1943.github.io/bugs/2018/09/19/Docker CheatSheet _ Docker é…ç½®ä¸å®è·µæ¸…å•/index.html">
<meta property="og:site_name" content="Bugs">
<meta property="og:description" content="æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://juejin.im/post/5ba11f635188255c8473a134?utm_source=gold_browser_extension   ğŸ“– èŠ‚é€‰è‡ª Awesome CheatSheet/Docker CheatSheetï¼Œå¯¹æ¥è‡ªå®˜æ–¹æ–‡æ¡£åŠ Docker Links ä¸­é“¾æ¥å†…å®¹çš„å½’æ¡£æ•´ç†ï¼ŒåŒ…å«äº†æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„ D">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f104dbaf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/18/165ed623ffd95804?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f11d39b7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f1044836?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f124b15d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:updated_time" content="2018-09-25T16:08:25.030Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker CheatSheet | Docker é…ç½®ä¸å®è·µ">
<meta name="twitter:description" content="æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://juejin.im/post/5ba11f635188255c8473a134?utm_source=gold_browser_extension   ğŸ“– èŠ‚é€‰è‡ª Awesome CheatSheet/Docker CheatSheetï¼Œå¯¹æ¥è‡ªå®˜æ–¹æ–‡æ¡£åŠ Docker Links ä¸­é“¾æ¥å†…å®¹çš„å½’æ¡£æ•´ç†ï¼ŒåŒ…å«äº†æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„ D">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f104dbaf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/bugs/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://deanwang1943.github.io/bugs/2018/09/19/Docker CheatSheet _ Docker é…ç½®ä¸å®è·µæ¸…å•/"/>





  <title>Docker CheatSheet | Docker é…ç½®ä¸å®è·µ | Bugs</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/bugs/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bugs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">å¾®ç¬‘çš„å‘¨æœ«</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/bugs/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/bugs/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/bugs/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/bugs/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://deanwang1943.github.io/bugs/bugs/2018/09/19/Docker CheatSheet _ Docker é…ç½®ä¸å®è·µæ¸…å•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dean Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/bugs/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bugs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Docker CheatSheet | Docker é…ç½®ä¸å®è·µ</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-19T00:36:03+00:00">
                2018-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/bugs/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://juejin.im/post/5ba11f635188255c8473a134?utm_source=gold_browser_extension" target="_blank" rel="noopener">https://juejin.im/post/5ba11f635188255c8473a134?utm_source=gold_browser_extension</a></p>
</blockquote>
<blockquote>
<p>ğŸ“– èŠ‚é€‰è‡ª <a href="https://link.juejin.im?target=https%3A%2F%2Fparg.co%2Fo9d" target="_blank" rel="noopener">Awesome CheatSheet/Docker CheatSheet</a>ï¼Œå¯¹æ¥è‡ª<a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.docker.com%2F" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>åŠ <a href="https://link.juejin.im?target=https%3A%2F%2Fparg.co%2Fo90" target="_blank" rel="noopener">Docker Links</a> ä¸­é“¾æ¥å†…å®¹çš„å½’æ¡£æ•´ç†ï¼ŒåŒ…å«äº†æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„ Docker æ¦‚å¿µä¸å‘½ä»¤ï¼Œå¦‚æœå¯¹äº Linux å¸¸ç”¨æ“ä½œå°šä¸ç†Ÿæ‚‰çš„å¯ä»¥å‚è€ƒ <a href="https://link.juejin.im?target=https%3A%2F%2Fparg.co%2FoiT" target="_blank" rel="noopener">Linux Commands CheatSheet</a>ã€‚</p>
</blockquote>
<h1 id="Docker-CheatSheet-Docker-é…ç½®ä¸å®è·µæ¸…å•"><a href="#Docker-CheatSheet-Docker-é…ç½®ä¸å®è·µæ¸…å•" class="headerlink" title="Docker CheatSheet | Docker é…ç½®ä¸å®è·µæ¸…å•"></a>Docker CheatSheet | Docker é…ç½®ä¸å®è·µæ¸…å•</h1><p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä» Apache2.0 åè®®å¼€æºã€‚Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f104dbaf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<p>è™šæ‹Ÿæœºæœ€å¤§çš„ç“¶é¢ˆåœ¨äºå…¶éœ€è¦ç‰¹æ®Šç¡¬ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯æ”¯æŒï¼Œå¹¶ä¸”æºå¸¦å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼›è€Œ Docker æ²¡æœ‰ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œå¯ä»¥è¿è¡Œåœ¨ç‰©ç†æœºã€è™šæ‹Ÿæœº, ç”šè‡³åµŒå¥—è¿è¡Œåœ¨ Docker å®¹å™¨å†…ï¼Œå¹¶ä¸”å…¶ä¸æºå¸¦æ“ä½œç³»ç»Ÿçš„ï¼Œä¼šè½»å·§å¾ˆå¤šã€‚åœ¨è°ƒç”¨å®¿ä¸»æœºçš„å†…å­˜ã€CPUã€ç£ç›˜ç­‰ç­‰èµ„æºæ—¶ï¼Œè™šæ‹Ÿæœºæ˜¯åˆ©ç”¨ Hypervisor å»è™šæ‹ŸåŒ–å†…å­˜ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜ -&gt; è™šæ‹Ÿç‰©ç†å†…å­˜ -&gt; çœŸæ­£ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯ Docker æ˜¯åˆ©ç”¨ Docker Engine å»è°ƒç”¨å®¿ä¸»çš„çš„èµ„æºï¼Œè¿™æ—¶å€™è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜ -&gt; çœŸæ­£ç‰©ç†å†…å­˜ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/18/165ed623ffd95804?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<p>Docker ç»¼åˆè¿ç”¨äº† Cgroup, Linux Namespaceï¼ŒSecomp capability, Selinux ç­‰æœºåˆ¶ï¼Œåœ¨ <a href="https://link.juejin.im?target=.%2FDocker-Internals-CheatSheet" target="_blank" rel="noopener">Docker Internals CheatSheet</a> ä¸­æˆ‘ä»¬ä¼šæœ‰è¯¦ç»†çš„è®¨è®ºï¼Œæˆ–è€…å‰å¾€ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fwxyyxc1992%2FBackend-Boilerplate%2Ftree%2Fmaster%2Fdocker" target="_blank" rel="noopener">Backend Boilerplate/docker</a> æµè§ˆå¸¸è§æœåŠ¡ / åº”ç”¨çš„ Docker é…ç½®æ¡ˆä¾‹ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f11d39b7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<h1 id="å®‰è£…ä¸é…ç½®"><a href="#å®‰è£…ä¸é…ç½®" class="headerlink" title="å®‰è£…ä¸é…ç½®"></a>å®‰è£…ä¸é…ç½®</h1><h2 id="Docker-CE"><a href="#Docker-CE" class="headerlink" title="Docker CE"></a>Docker CE</h2><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<a href="https://link.juejin.im?target=https%3A%2F%2Fmirrors.ustc.edu.cn%2Fhelp%2Fdocker-ce.html" target="_blank" rel="noopener">ç§‘å¤§çš„ Docker CE æº</a>è¿›è¡Œå®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æ›´æ”¹ Ubuntu é»˜è®¤æºåœ°å€</span><br><span class="line"><span class="meta">$</span> sudo sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å®‰è£…å¿…å¤‡çš„ç³»ç»Ÿå‘½ä»¤</span><br><span class="line"><span class="meta">$</span> sudo apt-get install -y python-software-properties</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> sudo add-apt-repository "deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu $(lsb_release -cs) stable"</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> apt-cache policy docker-ce # åˆ—ä¸¾ docker-ce ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> apt-get install docker-ce=17.03.2-ce....</span><br></pre></td></tr></table></figure>
<h2 id="Daemon-Configuration"><a href="#Daemon-Configuration" class="headerlink" title="Daemon Configuration"></a>Daemon Configuration</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> é…ç½®å¼€æœºè‡ªå¯åŠ¨</span><br><span class="line"><span class="meta">$</span> sudo systemctl enable docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å–æ¶ˆå¼€æœºè‡ªå¯åŠ¨</span><br><span class="line"><span class="meta">$</span> sudo systemctl disable docker</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹å­˜å‚¨è·¯å¾„ï¼ŒæŒ‡å®šé•œåƒå­˜å‚¨åœ°å€ï¼Œå…è®¸è¿œç¨‹è®¿é—®ï¼›æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ systemd ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ <code>/etc/docker/daemon.json</code>ï¼Œæ­¤å¤„ä»¥ä¿®æ”¹æœåŠ¡ä¸ºä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ä½¿ç”¨ systemctl å‘½ä»¤è¡Œä¿®æ”¹</span><br><span class="line"><span class="meta">$</span> sudo systemctl edit docker.service</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æˆ–è€…æŸ¥æ‰¾é…ç½®åœ°å€å¹¶ä½¿ç”¨ Vim ä¿®æ”¹</span><br><span class="line"><span class="meta">$</span> systemctl status docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ä¿®æ”¹æ–‡ä»¶å†…å®¹</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=</span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock --insecure-registry 10.196.108.176:5000 --dns 114.114.114.114 --dns 8.8.8.8 --dns 8.8.4.4 -g /mnt</span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡å¯æœåŠ¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> é‡æ–°è½½å…¥æœåŠ¡é…ç½®</span><br><span class="line"><span class="meta">$</span> sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> é‡å¯ Docker</span><br><span class="line"><span class="meta">$</span> sudo systemctl restart docker.service</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ¤æ–­æ˜¯å¦é…ç½®æˆåŠŸ</span><br><span class="line"><span class="meta">$</span> sudo netstat -lntp | grep dockerd</span><br></pre></td></tr></table></figure>
<h2 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Swarm</span><br><span class="line"><span class="meta">$</span> docker swarm init</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹ Swarm å¯†é’¥</span><br><span class="line"><span class="meta">$</span> docker swarm join-token -q worker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Procontainer</span><br><span class="line"><span class="meta">$</span> docker run -it -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Registry</span><br><span class="line"><span class="meta">$</span> docker run -d -p 5000:5000 --restart=always --name registry registry:2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å°†å­èŠ‚ç‚¹åŠ å…¥åˆ° Swarm</span><br><span class="line"><span class="meta">$</span> docker swarm join \</span><br><span class="line">--token $&#123;TOKEN&#125; \</span><br><span class="line">10.196.108.176:2377</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç†è®¾ç½®"><a href="#ä»£ç†è®¾ç½®" class="headerlink" title="ä»£ç†è®¾ç½®"></a>ä»£ç†è®¾ç½®</h2><p>é‰´äº gcr åŸŸåçš„ä¸å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ <a href="https://link.juejin.im?target=https%3A%2F%2Fhub.docker.com%2Fr%2Fbluebu%2Fshadowsocks-privoxy%2F" target="_blank" rel="noopener">ss-privoxy</a> ç­‰å·¥å…·æ­å»º Docker æºä»£ç†ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ<a href="https://link.juejin.im?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2F13f4b23824d8" target="_blank" rel="noopener">è¿™é‡Œ</a>æ‰‹åŠ¨é…ç½®å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker run -i -t -e SERVER_ADDR=ss.server.ip -e SERVER_PORT=port -e PASSWORD=123456 bluebu/shadowsocks-privoxy</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œéœ€è¦å…ˆå®‰è£… sslocal å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> apt install python3-pip</span><br><span class="line"><span class="meta">$</span> pip3 install https://github.com/shadowsocks/shadowsocks/archive/master.zip -U</span><br></pre></td></tr></table></figure>
<p>å†™å…¥ä½ çš„é…ç½®æ–‡ä»¶åˆ°ä¾‹å¦‚ <code>config.json</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "server": "...",</span><br><span class="line">    "server_port": ...,</span><br><span class="line">    "local_port": 1080,</span><br><span class="line">    "password": "..."</span><br><span class="line">    "method": "chacha20-ietf-poly1305",</span><br><span class="line">    "timeout": 600</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sslocal -c config.json</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶ä¸€ä¸ª socks5 ä»£ç†åœ¨ä½ æœ¬æœºå°±å¯åŠ¨äº†ã€‚ä¸‹é¢å®‰è£…é…ç½® privoxy æŠŠä»–è½¬æˆ http/https ä»£ç†ã€‚å®‰è£…ç•¥ã€‚ä¿®æ”¹ / æ·»åŠ ä¸¤ä¸ª privoxy çš„é…ç½® (å¯¹äº ubuntu, åœ¨ /etc/privoxy/config)ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listen-address 0.0.0.0:8118        # æ‰€æœ‰ interface ä¸Šç›‘å¬æµé‡</span><br><span class="line">forward-socks5 / 127.0.0.1:1080 .  # æµé‡å¯¼å‘æœ¬æœºä¸Šçš„ ss ä»£ç†</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å¯ä»¥è®¿é—®ä¸€ä¸‹ä¸å­˜åœ¨çš„ç½‘ç«™æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP_PROXY=127.0.0.1:8118 HTTPS_PROXY=127.0.0.1:8118 curl https://www.google.com</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢ä¿®æ”¹å„å°æœºå™¨çš„ docker é…ç½® (å‡å®šæˆ‘ä»¬çš„ master å†…ç½‘åœ°å€ <code>1.1.1.2</code>, å…¶ä»–ä¸¤å°æœºå™¨åœ°å€ä¸º <code>1.1.1.3</code> å’Œ <code>1.1.1.4</code>)ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Environment]</span><br><span class="line">Environment="HTTP_PROXY=127.0.0.1:8118" "HTTPS_PROXY=127.0.0.1:8118" "NO_PROXY=localhost,127.0.0.1,1.1.1.2,1.1.1.3,1.1.1.4"</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ç¯å¢ƒå˜é‡ <code>NO_PROXY</code> é¡¾åæ€ä¹‰ï¼Œå®ƒä¸æ”¯æŒ CIDR åº”è¯¥ï¼Œæ‰€ä»¥éœ€è¦ä½ æšä¸¾ä¸€ä¸‹é›†ç¾¤ä¸»æœºåœ°å€ã€‚</p>
<h1 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h1><p>é•œåƒæè¿°äº† Docker å®¹å™¨è¿è¡Œçš„åˆå§‹æ–‡ä»¶ç³»ç»Ÿ, åŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–ã€‚å³å¯ä»¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ, ä¹Ÿå¯ä»¥ä»…åŒ…å«åº”ç”¨æ‰€éœ€çš„æœ€å° bin/lib æ–‡ä»¶é›†åˆã€‚Docker é•œåƒå’Œå®¹å™¨é‡‡ç”¨åˆ†å±‚æ–‡ä»¶ç³»ç»Ÿç»“æ„, æ¯ä¸ªå®¹å™¨åŒ…å«ä¸€å±‚è–„è–„çš„å¯å†™å±‚, åªè¯»éƒ¨åˆ†æ˜¯å…±äº«çš„ï¼Œè¿™ç§æœºåˆ¶ä¿è¯äº†èµ„æºçš„å¯å¤ç”¨æ€§ï¼Œå‡å°‘äº†é•œåƒä¸å®¹å™¨çš„ç©ºé—´å ç”¨ã€‚Docker é•œåƒå­˜å‚¨å¼•æ“æœ‰ aufs, devicemapper, overlay ç­‰å¤šç§å®ç°ã€‚</p>
<h2 id="æ„å»ºä¸æ‹‰å–"><a href="#æ„å»ºä¸æ‹‰å–" class="headerlink" title="æ„å»ºä¸æ‹‰å–"></a>æ„å»ºä¸æ‹‰å–</h2><p>ç¼–å†™å®Œæˆ Dockerfile ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <code>docker build</code> å‘½ä»¤æ¥åˆ›å»ºé•œåƒï¼›å…³äº Dockfile çš„å…·ä½“è¯­æ³•ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹æ–‡ã€‚Dockfile åŸºæœ¬çš„æ ¼å¼ä¸º <code>docker build [ é€‰é¡¹ ] è·¯å¾„</code>ï¼Œè¯¥å‘½ä»¤å°†è¯»å–æŒ‡å®šè·¯å¾„ä¸‹ (åŒ…æ‹¬å­ç›®å½•) çš„ Dockerfileï¼Œå¹¶å°†è¯¥è·¯å¾„ä¸‹æ‰€æœ‰å†…å®¹å‘é€ç»™ Docker æœåŠ¡ç«¯ï¼Œç”±æœåŠ¡ç«¯æ¥åˆ›å»ºé•œåƒã€‚å› æ­¤ä¸€èˆ¬å»ºè®®æ”¾ç½® Dockerfile çš„ç›®å½•ä¸ºç©ºç›®å½•ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ <code>.dockerignore</code> æ–‡ä»¶ (æ¯ä¸€è¡Œæ·»åŠ ä¸€æ¡åŒ¹é…æ¨¡å¼) æ¥è®© Docker å¿½ç•¥è·¯å¾„ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶ã€‚</p>
<p>é•œåƒçš„å®Œæ•´ tag ä¸ä»…åŒ…å«é•œåƒåå­—, è¿˜æŒ‡æ˜äº†é•œåƒä»å“ªé‡Œæ¥, è¦åˆ°å“ªé‡Œå», å°±åƒä¸€ä¸ª URLã€‚å¯ä»¥é€šè¿‡ <code>-t</code> é€‰é¡¹æŒ‡å®šé•œåƒçš„æ ‡ç­¾ä¿¡æ¯ï¼Œè­¬å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo docker build -t myrepo/myapp /tmp/test1/</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> docker build -t username/image_name:tag_name .</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br></pre></td></tr></table></figure>
<p>Docker æ”¯æŒä» Registry æ‹‰å–é•œåƒï¼Œæˆ–è€…å°†æŸä¸ªå®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æ‹‰å–é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker pull image_name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å°†æŸä¸ªå®¹å™¨ä¿å­˜ä¸ºé•œåƒ</span><br><span class="line"><span class="meta">$</span> docker commit -m â€œcommit messageâ€ -a â€œauthorâ€Â Â container_name username/image_name:tag</span><br></pre></td></tr></table></figure>
<p>Docker æ”¯æŒå°†é•œåƒä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä»¥æ–¹ä¾¿é•œåƒçš„å¯¼å‡ºä¸åŠ è½½ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ä¿å­˜é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker save --output saved-image.tar my-image:1.0.0</span><br><span class="line"><span class="meta">$</span> docker save my-image:1.0.0 &gt; saved-image.tar</span><br><span class="line"><span class="meta">$</span> docker save my_image:my_tag | gzip &gt; my_image.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å¯¼å…¥é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker load --input saved-image.tar</span><br><span class="line"><span class="meta">$</span> docker load &lt; saved-image.tar</span><br></pre></td></tr></table></figure>
<h2 id="é•œåƒç®¡ç†"><a href="#é•œåƒç®¡ç†" class="headerlink" title="é•œåƒç®¡ç†"></a>é•œåƒç®¡ç†</h2><p><code>docker images</code> å‘½ä»¤ä¼šåˆ—ä¸¾å‡ºå…¨éƒ¨çš„é•œåƒ:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</span><br><span class="line">mynewimage          latest              4d2eab1c0b9a        5 minutes ago       278.1 MB</span><br><span class="line">ubuntu              14.04               ad892dd21d60        11 days ago         275.5 MB</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              6b0a59aa7c48        11 days ago         169.4 MB</span><br><span class="line">&lt;none&gt;              &lt;none&gt;              6cfa4d1f33fb        7 weeks ago         0 B</span><br></pre></td></tr></table></figure>
<p>Docker ä¸­é•œåƒä¸»è¦åˆ†ä¸ºä¸‰ç§çŠ¶æ€:</p>
<ul>
<li><strong>å·²ä½¿ç”¨é•œåƒï¼ˆused imageï¼‰</strong>ï¼š æŒ‡æ‰€æœ‰å·²è¢«å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰å…³è”çš„é•œåƒã€‚å³ docker ps -a çœ‹åˆ°çš„æ‰€æœ‰å®¹å™¨ä½¿ç”¨çš„é•œåƒã€‚</li>
<li><strong>æœªå¼•ç”¨é•œåƒï¼ˆunreferenced imageï¼‰</strong>ï¼šæ²¡æœ‰è¢«åˆ†é…æˆ–ä½¿ç”¨åœ¨å®¹å™¨ä¸­çš„é•œåƒï¼Œä½†å®ƒæœ‰ Tag ä¿¡æ¯ã€‚</li>
<li><strong>æ‚¬ç©ºé•œåƒï¼ˆdangling imageï¼‰</strong>ï¼šæœªé…ç½®ä»»ä½• Tag ï¼ˆä¹Ÿå°±æ— æ³•è¢«å¼•ç”¨ï¼‰çš„é•œåƒï¼Œæ‰€ä»¥æ‚¬ç©ºã€‚è¿™é€šå¸¸æ˜¯ç”±äºé•œåƒ build çš„æ—¶å€™æ²¡æœ‰æŒ‡å®š -t å‚æ•°é…ç½® Tag å¯¼è‡´çš„ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> åˆ—ä¸¾æœªä½¿ç”¨çš„</span><br><span class="line"><span class="meta">$</span> docker images --filter "dangling=true"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤æ‰€æœ‰æ— ç”¨çš„é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker rmi $(docker images -q -f dangling=true)</span><br></pre></td></tr></table></figure>
<h2 id="Dockfile"><a href="#Dockfile" class="headerlink" title="Dockfile"></a>Dockfile</h2><p>Dockerfile ç”±ä¸€è¡Œè¡Œå‘½ä»¤è¯­å¥ç»„æˆï¼Œå¹¶ä¸”æ”¯æŒä»¥ <code>#</code> å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚ä¸€èˆ¬çš„ï¼ŒDockerfile åˆ†ä¸ºå››éƒ¨åˆ†ï¼šåŸºç¡€é•œåƒä¿¡æ¯ã€ç»´æŠ¤è€…ä¿¡æ¯ã€é•œåƒæ“ä½œæŒ‡ä»¤å’Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ï¼›æŒ‡ä»¤çš„ä¸€èˆ¬æ ¼å¼ä¸º <code>INSTRUCTION arguments</code>ï¼ŒæŒ‡ä»¤åŒ…æ‹¬ <code>FROM</code>ã€<code>MAINTAINER</code>ã€<code>RUN</code> ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span> MongoDB Dockerfile</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span> https://github.com/dockerfile/mongodb</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Pull base image.</span><br><span class="line">FROM dockerfile/ubuntu</span><br><span class="line"></span><br><span class="line">ENV SOURCE http://downloads-distro.mongodb.org/repo/ubuntu-upstart</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Install MongoDB.</span><br><span class="line">RUN \</span><br><span class="line">  apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10 &amp;&amp; \</span><br><span class="line">  echo 'deb $SOURCE dist 10gen' &gt; /etc/apt/sources.list.d/mongodb.list &amp;&amp; \</span><br><span class="line">  apt-get update &amp;&amp; \</span><br><span class="line">  apt-get install -y mongodb-org &amp;&amp; \</span><br><span class="line">  rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">ENV PATH /usr/local/mongo/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Define mountable directories.</span><br><span class="line">VOLUME ["/data/db"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Define working directory.</span><br><span class="line">WORKDIR /data</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Define default command.</span><br><span class="line">CMD ["mongod"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Expose ports.</span><br><span class="line"><span class="meta">#</span>   - 27017: process</span><br><span class="line"><span class="meta">#</span>   - 28017: http</span><br><span class="line">EXPOSE 27017</span><br><span class="line">EXPOSE 28017</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œä¸€å¼€å§‹å¿…é¡»æŒ‡æ˜æ‰€åŸºäºçš„é•œåƒåç§°ï¼Œæ¥ä¸‹æ¥æ¨èè¯´æ˜ç»´æŠ¤è€…ä¿¡æ¯ã€‚åé¢åˆ™æ˜¯é•œåƒæ“ä½œæŒ‡ä»¤ï¼Œä¾‹å¦‚ <code>RUN</code> æŒ‡ä»¤ï¼Œ<code>RUN</code> æŒ‡ä»¤å°†å¯¹é•œåƒæ‰§è¡Œè·Ÿéšçš„å‘½ä»¤ã€‚æ¯è¿è¡Œä¸€æ¡ <code>RUN</code> æŒ‡ä»¤ï¼Œé•œåƒæ·»åŠ æ–°çš„ä¸€å±‚ï¼Œå¹¶æäº¤ã€‚æœ€åæ˜¯ <code>CMD</code> æŒ‡ä»¤ï¼Œæ¥æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„æ“ä½œå‘½ä»¤ã€‚</p>
<table>
<thead>
<tr>
<th>æŒ‡ä»¤å</th>
<th>æ ¼å¼</th>
<th>æè¿°</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>FROM</td>
<td>æ ¼å¼ä¸º <code>FROM &lt;image&gt;</code>æˆ–<code>FROM &lt;image&gt;:&lt;tag&gt;</code></td>
<td>ç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»ä¸º <code>FROM</code> æŒ‡ä»¤ã€‚</td>
<td>å¦‚æœåœ¨åŒä¸€ä¸ª Dockerfile ä¸­åˆ›å»ºå¤šä¸ªé•œåƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª <code>FROM</code> æŒ‡ä»¤ (æ¯ä¸ªé•œåƒä¸€æ¬¡)</td>
</tr>
<tr>
<td>MAINTAINER</td>
<td>æ ¼å¼ä¸º <code>MAINTAINER &lt;name&gt;</code></td>
<td>æŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯ã€‚</td>
<td></td>
</tr>
<tr>
<td>RUN</td>
<td><code>RUN &lt;command&gt;</code> æˆ– <code>RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</code></td>
<td>å‰è€…å°†åœ¨ shell ç»ˆç«¯ä¸­è¿è¡Œå‘½ä»¤ï¼Œå³ <code>/bin/sh -c</code>ï¼›åè€…åˆ™ä½¿ç”¨ <code>exec</code> æ‰§è¡Œã€‚æŒ‡å®šä½¿ç”¨å…¶å®ƒç»ˆç«¯å¯ä»¥é€šè¿‡ç¬¬äºŒç§æ–¹å¼å®ç°ï¼Œä¾‹å¦‚ <code>RUN [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo hello&quot;]</code></td>
<td>æ¯æ¡ <code>RUN</code> æŒ‡ä»¤å°†åœ¨å½“å‰é•œåƒåŸºç¡€ä¸Šæ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œå¹¶æäº¤ä¸ºæ–°çš„é•œåƒã€‚å½“å‘½ä»¤è¾ƒé•¿æ—¶å¯ä»¥ä½¿ç”¨ <code>\</code> æ¥æ¢è¡Œã€‚</td>
</tr>
<tr>
<td>CMD</td>
<td>æ”¯æŒä¸‰ç§æ ¼å¼,<code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code> ä½¿ç”¨ <code>exec</code> æ‰§è¡Œï¼Œæ¨èæ–¹å¼ï¼›<code>CMD command param1 param2</code> åœ¨ <code>/bin/sh</code> ä¸­æ‰§è¡Œï¼Œæä¾›ç»™éœ€è¦äº¤äº’çš„åº”ç”¨ï¼›<code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code> æä¾›ç»™ <code>ENTRYPOINT</code> çš„é»˜è®¤å‚æ•°ï¼›</td>
<td>æŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€æ¡ <code>CMD</code> å‘½ä»¤ã€‚å¦‚æœæŒ‡å®šäº†å¤šæ¡å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶å€™æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰ <code>CMD</code> æŒ‡å®šçš„å‘½ä»¤ã€‚</td>
<td></td>
</tr>
<tr>
<td>EXPOSE</td>
<td><code>EXPOSE &lt;port&gt; [&lt;port&gt;...]</code></td>
<td>å‘Šè¯‰ Docker æœåŠ¡ç«¯å®¹å™¨æš´éœ²çš„ç«¯å£å·ï¼Œä¾›äº’è”ç³»ç»Ÿä½¿ç”¨</td>
<td>åœ¨å¯åŠ¨å®¹å™¨æ—¶éœ€è¦é€šè¿‡ -p æ¥æŒ‡å®šç«¯å£æ˜ å°„ï¼ŒDocker ä¸»æœºä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£è½¬å‘åˆ°æŒ‡å®šçš„ç«¯å£</td>
</tr>
<tr>
<td>ENV</td>
<td><code>ENV&lt;key&gt;&lt;value&gt;</code>ã€‚æŒ‡å®šä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¼šè¢«åç»­ <code>RUN</code> æŒ‡ä»¤ä½¿ç”¨ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶ä¿æŒ</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ADD</td>
<td><code>ADD&lt;src&gt;&lt;dest&gt;</code></td>
<td>è¯¥å‘½ä»¤å°†å¤åˆ¶æŒ‡å®šçš„ <code>&lt;src&gt;</code> åˆ°å®¹å™¨ä¸­çš„ <code>&lt;dest&gt;</code>ã€‚</td>
<td><code>&lt;src&gt;</code> å¯ä»¥æ˜¯ Dockerfile æ‰€åœ¨ç›®å½•çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª URLï¼›è¿˜å¯ä»¥æ˜¯ä¸€ä¸ª tar æ–‡ä»¶ (è‡ªåŠ¨è§£å‹ä¸ºç›®å½•)</td>
</tr>
<tr>
<td>COPY</td>
<td><code>COPY &lt;src&gt;&lt;dest&gt;</code></td>
<td>å¤åˆ¶æœ¬åœ°ä¸»æœºçš„ <code>&lt;src&gt;</code>(ä¸º Dockerfile æ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„) åˆ°å®¹å™¨ä¸­çš„ <code>dest</code></td>
<td>å½“ä½¿ç”¨æœ¬åœ°ç›®å½•ä¸ºæºç›®å½•æ—¶ï¼Œæ¨èä½¿ç”¨ <code>COPY</code></td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td><code>ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</code>ï¼Œä½¿ç”¨æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œï¼›<code>ENTRYPOINT command param1 param2</code>ï¼Œä¼šåœ¨ Shell ä¸­æ‰§è¡Œ</td>
<td>é…ç½®å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¸å¯è¢« <code>docker run</code> æä¾›çš„å‚æ•°è¦†ç›–ã€‚æ¯ä¸ª Dockerfile ä¸­åªèƒ½æœ‰ä¸€ä¸ª <code>ENTRYPOINT</code>ï¼Œå½“æŒ‡å®šå¤šä¸ªæ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªèµ·æ•ˆã€‚</td>
<td></td>
</tr>
<tr>
<td>VOLUME</td>
<td><code>VOLUME [&quot;/data&quot;]</code></td>
<td>åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»æœ¬åœ°ä¸»æœºæˆ–å…¶ä»–å®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ï¼Œä¸€èˆ¬ç”¨æ¥å­˜æ”¾æ•°æ®åº“å’Œéœ€è¦ä¿æŒçš„æ•°æ®ç­‰</td>
<td></td>
</tr>
<tr>
<td>USER</td>
<td><code>USER daemon</code></td>
<td>æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åæˆ– UIDï¼Œåç»­çš„ <code>RUN</code> ä¹Ÿä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·</td>
<td></td>
</tr>
<tr>
<td>WORKDIR</td>
<td><code>WORKDIR /path/to/workdir</code></td>
<td>ä¸ºåç»­çš„ <code>RUN</code>ã€<code>CMD</code>ã€<code>ENTRYPOINT</code> æŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•</td>
<td>å¯ä»¥ä½¿ç”¨å¤šä¸ª <code>WORKDIR</code> æŒ‡ä»¤ï¼Œåç»­å‘½ä»¤å¦‚æœå‚æ•°æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåŸºäºä¹‹å‰å‘½ä»¤æŒ‡å®šçš„è·¯å¾„</td>
</tr>
</tbody>
</table>
<p>å½“æœåŠ¡ä¸éœ€è¦ç®¡ç†å‘˜æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŒ‡å®šè¿è¡Œç”¨æˆ·ã€‚å¹¶ä¸”å¯ä»¥åœ¨ä¹‹å‰åˆ›å»ºæ‰€éœ€è¦çš„ç”¨æˆ·ï¼Œä¾‹å¦‚ï¼š<code>RUN groupadd -r postgres &amp;&amp; useradd -r -g postgres postgres</code>ï¼›è¦ä¸´æ—¶è·å–ç®¡ç†å‘˜æƒé™å¯ä»¥ä½¿ç”¨ <code>gosu</code>ï¼Œè€Œä¸æ¨è <code>sudo</code>ã€‚</p>
<p>RUNã€CMD å’Œ ENTRYPOINT è¿™ä¸‰ä¸ª Dockerfile æŒ‡ä»¤çœ‹ä¸Šå»å¾ˆç±»ä¼¼ï¼Œå¾ˆå®¹æ˜“æ··æ·†ã€‚RUN æ‰§è¡Œå‘½ä»¤å¹¶åˆ›å»ºæ–°çš„é•œåƒå±‚ï¼ŒRUN ç»å¸¸ç”¨äºå®‰è£…è½¯ä»¶åŒ…ã€‚CMD è®¾ç½®å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ï¼Œä½† CMD èƒ½å¤Ÿè¢« docker run åé¢è·Ÿçš„å‘½ä»¤è¡Œå‚æ•°æ›¿æ¢ã€‚ENTRYPOINT é…ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚æˆ‘ä»¬ç»å¸¸å¯ä»¥ä½¿ç”¨ ENTRYPOINT æŒ‡å®šå›ºå®šå‘½ä»¤ï¼Œä½¿ç”¨ CMD åŠ¨æ€ä¼ å…¥å‚æ•°ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ENTRYPOINT ["/bin/echo", "Hello"]</span><br><span class="line">CMD ["world"]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> docker run -it &lt;image&gt;</span><br><span class="line"><span class="meta">#</span> Hello world</span><br><span class="line"><span class="meta">#</span> docker run -it &lt;image&gt; John</span><br><span class="line"><span class="meta">#</span> Hello John</span><br></pre></td></tr></table></figure>
<p>Docker æ¨èçš„æ˜¯å•ä¸ªå®¹å™¨æ‰§è¡Œå•ä¸ªä»»åŠ¡çš„å…³æ³¨ç‚¹åˆ†ç¦»ç­–ç•¥ï¼Œå®¹å™¨çš„ä¸»è¿›ç¨‹ä¼šè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„å­è¿›ç¨‹ã€‚å¦‚æœæˆ‘ä»¬æœªåœ¨è‡ªå®šä¹‰åˆå§‹åŒ–è„šæœ¬ä¸­è€ƒè™‘å¤ªå¤šå­è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>--init</code> å‚æ•°æ¥å…è®¸ Docker è‡ªåŠ¨æ³¨å…¥ init è¿›ç¨‹ä½œä¸ºä¸»è¿›ç¨‹ï¼Œå…¶ä¼šåœ¨å®¹å™¨å…³é—­æ—¶å€™è‡ªåŠ¨å¤„ç†æ‰€æœ‰çš„æ´¾ç”Ÿçš„å­è¿›ç¨‹ï¼Œå¹¶ä¸”ç›¸å¯¹äºå®Œæ•´çš„ sysvinit æˆ–è€… systemd æ›´ä¸ºè½»é‡çº§ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å•ä¸ªå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ supervisord æˆ–è€…<a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.docker.com%2Fconfig%2Fcontainers%2Fmulti-service_container%2F" target="_blank" rel="noopener">è‡ªå®šä¹‰è„šæœ¬</a>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:latest</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y supervisor</span><br><span class="line">RUN mkdir -p /var/log/supervisor</span><br><span class="line">COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf</span><br><span class="line">COPY my_first_process my_first_process</span><br><span class="line">COPY my_second_process my_second_process</span><br><span class="line">CMD ["/usr/bin/supervisord"]</span><br></pre></td></tr></table></figure>
<h2 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h2><p>Docker å…è®¸æˆ‘ä»¬å»ºç«‹ç§æœ‰çš„ Registry æ¥å­˜æ”¾äºç®¡ç†é•œåƒï¼Œç›´æ¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯åˆ›å»ºç§æœ‰ Registryï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker run -d -p 5000:5000 --restart=always --name registry registry:2</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒä¸Šæ–‡æè¿°æˆ‘ä»¬å¯çŸ¥ï¼Œé•œåƒåçš„å‰ç¼€å³è¡¨ç¤ºè¯¥é•œåƒæ‰€å±çš„ Registry åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ tag æ–¹å¼å°†æŸä¸ªé•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æ‹‰å–å…¬å…±é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker pull ubuntu:16.04</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ä¸ºé•œåƒæ·»åŠ  Registry ä¿¡æ¯</span><br><span class="line"><span class="meta">$</span> docker tag ubuntu:16.04 custom-domain:5000/my-ubuntu</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å°†å…¶æ¨é€åˆ°ç§æœ‰é•œåƒåº“</span><br><span class="line"><span class="meta">$</span> docker push custom-domain:5000/my-ubuntu</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ä»ç§æœ‰é•œåƒåº“ä¸­æ‹‰å–é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker pull custom-domain:5000/my-ubuntu</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šé•œåƒåº“çš„å­˜æ”¾åœ°å€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-v /mnt/registry:/var/lib/registry</span><br></pre></td></tr></table></figure>
<p>å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬çš„å†…éƒ¨ä»“åº“å¹¶ä¸ä¼šé…ç½® HTTPSï¼Œå¦‚æœå¸Œæœ›ä»¥ HTTP æ–¹å¼è®¿é—®ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ä»»ä½•éœ€è¦æ¨é€ / æ‹‰å–é•œåƒçš„æœºå™¨ä¸Šé…ç½®éå®‰å…¨åŸŸåï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; "insecure-registries": ["myregistry.example.com:5000"] &#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºç§æœ‰ä»“åº“é…ç½®æƒé™è®¤è¯ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦æ·»åŠ  TLS æ”¯æŒï¼Œå¹¶ä¸”é…ç½®è®¤è¯æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> mkdir auth</span><br><span class="line"><span class="meta">$</span> docker run \</span><br><span class="line">  --entrypoint htpasswd \</span><br><span class="line">  registry:2 -Bbn cscan cscancscan &gt; ~/auth/htpasswd</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> openssl req -new -newkey rsa:4096 -days 365 \</span><br><span class="line">                -subj "/CN=localhost" \</span><br><span class="line">                -nodes -x509  \</span><br><span class="line">                -keyout ~/certs/domain.key \</span><br><span class="line">                -out ~/certs/domain.crt</span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯ä»¥ä½¿ç”¨ Compose æ–‡ä»¶æ¥æè¿°æ‰€éœ€è¦çš„ TLS ä»¥åŠ AUTH å‚æ•°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">registry-srv:</span><br><span class="line">  restart: always</span><br><span class="line">  image: registry:2</span><br><span class="line">  ports:</span><br><span class="line">    - 5000:5000</span><br><span class="line">  environment:</span><br><span class="line">    REGISTRY_HTTP_TLS_CERTIFICATE: /certs/domain.crt</span><br><span class="line">    REGISTRY_HTTP_TLS_KEY: /certs/domain.key</span><br><span class="line">    REGISTRY_AUTH: htpasswd</span><br><span class="line">    REGISTRY_AUTH_HTPASSWD_PATH: /auth/htpasswd</span><br><span class="line">    REGISTRY_AUTH_HTPASSWD_REALM: Registry Realm</span><br><span class="line">  volumes:</span><br><span class="line">    - /opt/registry:/var/lib/registry</span><br><span class="line">    - ~/certs:/certs</span><br><span class="line">    - ~/auth:/auth</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ä½¿ç”¨ Docker Compose å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç™»å½•åˆ°é•œåƒæœåŠ¡å™¨</span><br><span class="line"><span class="meta">$</span> docker login myregistrydomain.com:5000</span><br></pre></td></tr></table></figure>
<h1 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h1><p>Docker ä¸­é•œåƒæ˜¯åªè¯»çš„, åˆ›å»ºå®¹å™¨æ—¶åªæ˜¯åœ¨é•œåƒä¸Šé¢æ–°å»ºä¸€ä¸ªå¯å†™å±‚, ä¸éœ€è¦å¤åˆ¶æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ, å› è€Œå¯ä»¥å®ç°æ¯«ç§’çº§åˆ›å»ºã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f1044836?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<h2 id="å¯åœæ§åˆ¶"><a href="#å¯åœæ§åˆ¶" class="headerlink" title="å¯åœæ§åˆ¶"></a>å¯åœæ§åˆ¶</h2><ul>
<li><code>docker create</code>: åˆ›å»ºä¸€ä¸ªå®¹å™¨ä½†æ˜¯ä¸å¯åŠ¨ã€‚</li>
<li><code>docker rename</code>: å…è®¸é‡å‘½åå®¹å™¨ã€‚</li>
<li><code>docker run</code>: åœ¨åŒä¸€ä¸ªæ“ä½œä¸­åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚</li>
<li><code>docker rm</code>: åˆ é™¤å®¹å™¨ã€‚</li>
<li><code>docker update</code>: æ›´æ–°å®¹å™¨çš„èµ„æºé™åˆ¶ã€‚</li>
</ul>
<p>å®¹å™¨ä¼šåœ¨ç»“æŸå‘½ä»¤ä¹‹åè‡ªåŠ¨é€€å‡ºï¼Œä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤é€‰é¡¹å¯ä»¥å°†å®¹å™¨ä¿æŒåœ¨æ¿€æ´»çŠ¶æ€ï¼š</p>
<ul>
<li><p><code>-i</code> å³ä½¿åœ¨æ²¡æœ‰é™„ç€çš„æƒ…å†µä¸‹ä¾ç„¶ä¿æŒ STDIN å¤„äºå¼€å¯ã€‚å•çº¯ä½¿ç”¨ -i å‘½ä»¤æ˜¯ä¸ä¼šå‡ºç° <code>root@689d580b6416:/</code> è¿™ç§å‰ç¼€</p>
</li>
<li><p><code>-t</code> åˆ†é…ä¸€ä¸ªä¼ª TTY æ§åˆ¶å°</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> åˆ›å»ºï¼Œå¹¶ä¸”å¯åŠ¨æŸä¸ªå®¹å™¨ä»¥æ‰§è¡ŒæŸä¸ªå‘½ä»¤</span><br><span class="line"><span class="meta">$</span> docker run -ti --name container_name image_name command</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ›å»ºï¼Œå¯åŠ¨å®¹å™¨æ‰§è¡ŒæŸä¸ªå‘½ä»¤ç„¶ååˆ é™¤è¯¥å®¹å™¨</span><br><span class="line"><span class="meta">$</span> docker run --rm -ti image_name command</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ›å»ºï¼Œå¯åŠ¨å®¹å™¨ï¼Œå¹¶ä¸”æ˜ å°„å·ä¸ç«¯å£ï¼ŒåŒæ—¶è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="line"><span class="meta">$</span> docker run -it --rm -p 8080:8080 -v /path/to/agent.jar:/agent.jar -e JAVA_OPTS=â€-javaagent:/agent.jarâ€ tomcat:8.0.29-jre8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ›å»ºå®¹å™¨ï¼ŒæŒ‡å®šç½‘ç»œ</span><br><span class="line"><span class="meta">$</span> docker run --network=&lt;NETWORK&gt;</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºå®¹å™¨æ—¶ï¼Œå®ƒä¸ä¼šå°†å…¶ä»»ä½•ç«¯å£å‘å¸ƒåˆ°å¤–éƒ¨ä¸–ç•Œã€‚è¦ä½¿ç«¯å£å¯ç”¨äº Docker ä¹‹å¤–çš„æœåŠ¡æˆ–æœªè¿æ¥åˆ°å®¹å™¨ç½‘ç»œçš„ Docker å®¹å™¨ï¼Œè¯·ä½¿ç”¨ â€“publish æˆ– -p æ ‡å¿—ã€‚è¿™ä¼šåˆ›å»ºä¸€ä¸ªé˜²ç«å¢™è§„åˆ™ï¼Œå°†å®¹å™¨ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºä¸Šçš„ç«¯å£ã€‚</p>
<table>
<thead>
<tr>
<th>æ ‡å¿—å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-p 8080:80</code></td>
<td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£ (TCP)</td>
</tr>
<tr>
<td><code>-p 8080:80/udp</code></td>
<td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£ (UDP)</td>
</tr>
<tr>
<td><code>-p 8080:80/tcp -p 8080:80/udp</code></td>
<td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£ (TCP å’Œ UDP)</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å¯åŠ¨/åœæ­¢æŸä¸ªå®¹å™¨</span><br><span class="line">$ docker [start|stop] container_name</span><br><span class="line"></span><br><span class="line"># åœ¨æŸä¸ªå®¹å™¨å†…æ‰§è¡ŒæŸæ¡å‘½ä»¤</span><br><span class="line">$ docker exec -ti container_name command.sh</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„è¾“å‡ºæ—¥å¿—</span><br><span class="line">$ docker logs -ft container_name</span><br></pre></td></tr></table></figure>
<h2 id="çŠ¶æ€æŸ¥è¯¢"><a href="#çŠ¶æ€æŸ¥è¯¢" class="headerlink" title="çŠ¶æ€æŸ¥è¯¢"></a>çŠ¶æ€æŸ¥è¯¢</h2><ul>
<li>docker ps æŸ¥çœ‹è¿è¡Œä¸­çš„æ‰€æœ‰å®¹å™¨ã€‚</li>
<li>docker logs ä»å®¹å™¨ä¸­è·å–æ—¥å¿—ã€‚(ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ—¥å¿—é©±åŠ¨ï¼Œä¸è¿‡åœ¨ 1.10 ä¸­ï¼Œå®ƒåªæ”¯æŒ json-file å’Œ journald)</li>
<li>docker inspect æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ‰€æœ‰ä¿¡æ¯ (åŒ…æ‹¬ IP åœ°å€)ã€‚</li>
<li>docker events ä»å®¹å™¨ä¸­è·å–äº‹ä»¶ (events)ã€‚</li>
<li>docker port æŸ¥çœ‹å®¹å™¨çš„å…¬å¼€ç«¯å£ã€‚</li>
<li>docker top æŸ¥çœ‹å®¹å™¨ä¸­æ´»åŠ¨è¿›ç¨‹ã€‚</li>
<li>docker stats æŸ¥çœ‹å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>docker diff æŸ¥çœ‹å®¹å™¨çš„ FS ä¸­æœ‰å˜åŒ–æ–‡ä»¶ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æ ¹æ®æ¡ä»¶è¿‡æ»¤æŸ¥è¯¢</span><br><span class="line"><span class="meta">$</span> docker ps --filter "</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨åˆ—è¡¨</span><br><span class="line"><span class="meta">$</span> docker stats --all</span><br></pre></td></tr></table></figure>
<h2 id="ç®¡ç†é…ç½®"><a href="#ç®¡ç†é…ç½®" class="headerlink" title="ç®¡ç†é…ç½®"></a>ç®¡ç†é…ç½®</h2><p>åˆ›å»ºå®¹å™¨æ—¶ä¹Ÿå¯ä»¥å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼Œå³æ˜¯å½“å®¹å™¨å‡ºé”™é€€å‡ºæˆ–è€…å®¿ä¸»æœºé‡å¯æ—¶å€™ï¼Œå®¹å™¨çš„åº”å¯¹ç­–ç•¥ï¼›é‡å¯ç­–ç•¥åŒæ ·ä¼šä¿è¯ç›¸å…³è”çš„å®¹å™¨ä»¥æ­£ç¡®çš„é¡ºåºé‡å¯ï¼Œé¿å…æ„å¤–çš„é”™è¯¯ã€‚</p>
<ul>
<li>no: ä¸è¿›è¡Œé‡å¯</li>
<li>on-failure: å½“å®¹å™¨ä»¥éé›¶çŠ¶æ€ç é€€å‡ºæ—¶é‡å¯å®¹å™¨</li>
<li>unless-stopped: å½“æŸä¸ªå®¹å™¨è¢«æ˜¾æ€§å…³é—­æˆ–è€… Docker æœ¬èº«å…³é—­æˆ–é‡å¯æ—¶é‡å¯</li>
<li>always: æ— è®ºå‡ºç°ä»»ä½•æƒ…å†µéƒ½é‡å¯å®¹å™¨</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> è®¾ç½®é‡å¯ç­–ç•¥</span><br><span class="line"><span class="meta">#</span>â€ŠOff, On-failure, Unless-stopped, Always</span><br><span class="line"><span class="meta">$</span> docker run -dit â€” restart unless-stopped [CONTAINER]</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥é€šè¿‡å¤šç§è¿‡æ»¤æ¡ä»¶æ¥è¿›è¡Œå®¹å™¨çš„ç§»é™¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å…³é—­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line"><span class="meta">$</span> docker kill $(docker ps -q)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç§»é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨</span><br><span class="line"><span class="meta">$</span> docker rm $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ ¹æ®çŠ¶æ€ç§»é™¤</span><br><span class="line"><span class="meta">$</span> docker rm $(docker ps -q -f 'status=exited')</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ ¹æ®æ ‡ç­¾ç§»é™¤</span><br><span class="line"><span class="meta">$</span> docker rm $(docker ps -a | grep rabbitmq | awk '&#123;print $1&#125;')</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> docker rm $(docker ps -a | grep "46 hours ago")</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å®¹å™¨ä¸­çš„æ–‡ä»¶è¿›è¡Œå¯¼å…¥å¯¼å‡ºæ“ä½œ:</p>
<ul>
<li>docker cp åœ¨å®¹å™¨å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚</li>
<li>docker export å°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿåˆ‡æ¢ä¸ºå‹ç¼©åŒ… (tarball archive stream) è¾“å‡ºåˆ° STDOUTã€‚</li>
</ul>
<h2 id="èµ„æºé…é¢"><a href="#èµ„æºé…é¢" class="headerlink" title="èµ„æºé…é¢"></a>èµ„æºé…é¢</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker stats</code> å‘½ä»¤æ¥æŸ¥çœ‹ Docker å®¹å™¨çš„æ€§èƒ½çŠ¶æ€ä¸èµ„æºå ç”¨:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker stats redis1 redis2</span><br><span class="line"></span><br><span class="line">CONTAINER           CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O</span><br><span class="line">redis1              0.07%               796 KB / 64 MB        1.21%               788 B / 648 B       3.568 MB / 512 KB</span><br></pre></td></tr></table></figure>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker run -it -m 300M ubuntu:14.04 /bin/bash</span><br></pre></td></tr></table></figure>
<h3 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h3><p>åœ¨çº¿ä¸Šç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å³å¸Œæœ›èƒ½å¤Ÿå°½é‡é¿å… CPU ç©ºé—´æ—¶é—´ç‰‡ï¼Œæœ€å¤§åŒ–èµ„æºåˆ©ç”¨ç‡ï¼Œä¹Ÿè¦ä¿éšœé‡ç‚¹ä¸šåŠ¡çš„èµ„æºå ç”¨ï¼Œé¿å…å› æŸä¸ªå¼‚å¸¸å®¹å™¨å ç”¨æˆ–ä¸åˆç†ä½¿ç”¨æ•´æœº CPU èµ„æºï¼Œé€ æˆå®¿ä¸»æœºä¸Šå¤§é‡å®¹å™¨å¼‚å¸¸ï¼›æ­¤æ—¶å•å®¹å™¨çš„ CPU èµ„æºçº¦æŸåŠä¸Šé™å°†å˜å¾—éå¸¸é‡è¦ï¼Œæ—¢ä¸èƒ½é™å¾—å¤ªæ­»ï¼Œåˆä¸èƒ½é™ä¸ä½ï¼Œå°†é€šè¿‡å†…æ ¸å’Œè°ƒåº¦ç³»ç»Ÿçš„é™åˆ¶æœºåˆ¶æ¥ä¿éšœèµ„æºç¨³å®šæ€§ã€‚Docker å…è®¸ä½¿ç”¨ cpus, cpuset-cpus, cpu-shares ç­‰æ¥é™åˆ¶å®¹å™¨çš„è®¡ç®—èµ„æºå ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‡å®šå®¹å™¨å¯å ç”¨çš„ CPU æ ¸ç¼–å·ï¼Œ0-3 è¡¨ç¤ºå ç”¨å››ä¸ªæ ¸ï¼Œ1,3 è¡¨ç¤ºå ç”¨ä¸¤ä¸ªæ ¸</span><br><span class="line">$ docker run -it --cpuset-cpus=&quot;1,3&quot; ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line"># æœ€å¤šå…è®¸å ç”¨å• CPU 50% çš„è®¡ç®—èµ„æºï¼Œå¦‚æœåŒæ ¸ CPUï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸º 1.5 ç­‰</span><br><span class="line">$ docker run -it --cpus=&quot;.5&quot; ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line"># ä¸åŒçš„å€¼èƒ½å¤ŸæŒ‡å®šä¸åŒçš„å®¹å™¨æƒé‡ï¼Œç”¨äºåŠ¨æ€åˆ†é… CPU èµ„æº</span><br><span class="line">$ docker run -it --cpu-shares=&quot;512&quot; ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
<ul>
<li><p>CPU Set ä¿éšœäº†å®¹å™¨çš„ CPU æ ¸æ•°ï¼Œå®‰å…¨æ€§è¾ƒå¼ºï¼Œä½†æ˜¯æ•´ä½“èµ„æºåˆ©ç”¨ç‡ä½ã€‚å¦‚æœå®¹å™¨å®é™…å¹¶ä¸éœ€è¦å¦‚æ­¤å¤šæ ¸çš„ CPU èµ„æºæ¥å¤„ç†ä»»åŠ¡åˆ™ä¼šé€ æˆèµ„æºæµªè´¹ï¼Œå¹¶ä¸”å¯¼è‡´å…¶ä»–å®¹å™¨ä¸Šçš„ä»»åŠ¡æ— æ³•åˆ©ç”¨è¯¥å®¹å™¨ä¸Šçš„ CPU ç©ºé—²æ—¶é—´ç‰‡ï¼Œäººä¸ºé˜»æ–­äº† CPU é—²æ—¶å¤ç”¨çš„èƒ½åŠ›ã€‚</p>
</li>
<li><p>CPU Share å…è®¸é€šè¿‡å…±äº«çš„æ–¹å¼è·å¾— CPU èµ„æºï¼Œä¸åŒçš„å®¹å™¨å…±äº«ä¸€å®šæ€»é‡çš„ CPU è®¡ç®—èƒ½åŠ›ï¼Œæ¯ä¸ªå®¹å™¨éƒ½ç»‘å®šå…¨é‡æ ¸ï¼Œè€Œæ¯ä¸ªå®¹å™¨è·å–ä¸€å®šä»½é¢çš„ CPU è®¡ç®—åŠ›ã€‚è¯¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªå®¹å™¨çš„ CPU èµ„æºåˆ†é…ä¸å†ä»¥æ•´æ ¸åˆ†é…ï¼Œè€Œæ˜¯å¯ç²¾ç»†åˆ° CPU æ—¶é—´ç‰‡ä»½é¢çš„ç²’åº¦ï¼Œå¹¶ä¸”æ˜¯è¿ç»­çš„ CPU æ ¸èƒ½åŠ›å€¼ã€‚å½“æ•´æœºé—²æ—¶ï¼Œå¯ä»¥è®©è¾ƒä¸ºç¹å¿™çš„ä¸šåŠ¡è·å¾—æ•´æœºç©ºé—²ã€‚é‡‡ç”¨ CPU èµ„æºå…±äº«çš„æœºåˆ¶ï¼Œå…¶èµ„æºéš”ç¦»æ€§æ²¡æœ‰ set æ¨¡å¼å¼ºï¼Œå¯¹äºæä¸ªåˆ« CPU èµ„æºæ•æ„Ÿå‹ä¸šåŠ¡ï¼Œæœ‰å¯èƒ½å‡ºç°å¶å°”ç­‰å¾… CPU æ—¶é—´ç‰‡çš„æƒ…å†µï¼Œè€Œå½±å“ä¸šåŠ¡ç¨³å®šæ€§ã€‚å¯¹äºæå°‘æ•°çš„è¿™ç±»ä¸šåŠ¡ï¼Œæˆ‘ä»¬å®¹è®¸ç»§ç»­ä½¿ç”¨ CPU set æ¨¡å¼ã€‚</p>
</li>
</ul>
<h3 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h3><p>å¦‚æœä½¿ç”¨ Device Mapper ä½œä¸ºåº•å±‚å­˜å‚¨é©±åŠ¨ï¼Œåˆ™å¯ä»¥é€šè¿‡ Docker daemon çš„å¦‚ä¸‹å‚æ•°æ¥å…¨å±€é™åˆ¶å•ä¸ªå®¹å™¨å ç”¨ç©ºé—´çš„å¤§å°:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># é™åˆ¶å•ä¸ªå®¹å™¨æœ€å¤šå ç”¨ 20G ç©ºé—´ï¼Œå°†åº”ç”¨äºä»»ä½•æ–°å»ºå®¹å™¨ã€‚</span><br><span class="line">$ --storage-opt dm.basesize=20G</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯ btrfs å­˜å‚¨é©±åŠ¨ï¼Œå¯ä½¿ç”¨å…¶æä¾›çš„ subvolume åŠŸèƒ½æ¥å®ç°ã€‚ä¸€ä¸ªå®¹å™¨ä¼šå¯¹åº”ä¸€ä¸ª subvolumeã€‚é’ˆå¯¹å®¹å™¨å¯¹åº”çš„ subvolume å¯ç”¨å¹¶é…ç½® quota å³å¯é™åˆ¶å…¶ç£ç›˜ç©ºé—´:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ btrfs qgroup limit -e 50G /var/lib/docker/btrfs/subvolumes/&lt;CONTAINER_ID&gt;</span><br></pre></td></tr></table></figure>
<p>æˆäºˆå¯¹å•ä¸ªè®¾å¤‡è®¿é—®æƒé™:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --device=/dev/ttyUSB0 debian bash</span><br></pre></td></tr></table></figure>
<p>æˆäºˆæ‰€æœ‰è®¾å¤‡è®¿é—®æƒé™:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged -v /dev/bus/usb:/dev/bus/usb debian bash</span><br></pre></td></tr></table></figure>
<h1 id="èµ„æºé…ç½®"><a href="#èµ„æºé…ç½®" class="headerlink" title="èµ„æºé…ç½®"></a>èµ„æºé…ç½®</h1><h2 id="Volume-æ•°æ®å·"><a href="#Volume-æ•°æ®å·" class="headerlink" title="Volume | æ•°æ®å·"></a>Volume | æ•°æ®å·</h2><p>å®¹å™¨è¿è¡Œæ—¶åº”è¯¥å°½é‡ä¿æŒå®¹å™¨å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œï¼Œå¯¹äºæ•°æ®åº“ç±»éœ€è¦ä¿å­˜åŠ¨æ€æ•°æ®çš„åº”ç”¨ï¼Œå…¶æ•°æ®åº“æ–‡ä»¶åº”è¯¥ä¿å­˜äºå· (Volume) ä¸­ã€‚ä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶æ‰€ä¿å­˜ç›®å½•æŒ‚è½½ä¸ºå·ï¼Œåœ¨ Dockerfile ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚</p>
<p>æ•°æ®å·æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š</p>
<ul>
<li><p>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨</p>
</li>
<li><p>å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ</p>
</li>
<li><p>å¯¹æ•°æ®å·çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ</p>
</li>
<li><p>å·ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨</p>
</li>
<li><p>æ•°æ®å·çš„ä½¿ç”¨ï¼Œç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountã€‚</p>
</li>
</ul>
<p>For example,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># the following creates a tmpfs volume called foo with a size of 100 megabyte and uid of 1000.</span><br><span class="line">$ docker volume create --driver local \</span><br><span class="line">    --opt type=tmpfs \</span><br><span class="line">    --opt device=tmpfs \</span><br><span class="line">    --opt o=size=100m,uid=1000 \</span><br><span class="line">    foo</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line"></span><br><span class="line">nother example that uses nfs to mount the /path/to/dir in rw mode from 192.168.1.1:</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">$ docker volume create --driver local \</span><br><span class="line">    --opt type=nfs \</span><br><span class="line">    --opt o=addr=192.168.1.1,rw \</span><br><span class="line">    --opt device=:/path/to/dir \</span><br><span class="line">    foo</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker run -d \</span><br><span class="line">  -it \</span><br><span class="line">  --name devtest \</span><br><span class="line">  -v myvol2:/app \</span><br><span class="line">  nginx:latest</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">"Mounts": [</span><br><span class="line">    &#123;</span><br><span class="line">        "Type": "volume",</span><br><span class="line">        "Name": "myvol2",</span><br><span class="line">        "Source": "/var/lib/docker/volumes/myvol2/_data",</span><br><span class="line">        "Destination": "/app",</span><br><span class="line">        "Driver": "local",</span><br><span class="line">        "Mode": "",</span><br><span class="line">        "RW": true,</span><br><span class="line">        "Propagation": ""</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>Docker <code>-v</code> æ ‡è®°ä¹Ÿå¯ä»¥æŒ‡å®šæŒ‚è½½ä¸€ä¸ªæœ¬åœ°ä¸»æœºçš„ç›®å½• / æ–‡ä»¶åˆ°å®¹å™¨ä¸­å»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‚è½½ç›®å½•</span><br><span class="line">$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py</span><br><span class="line"></span><br><span class="line"># æŒ‚è½½æ–‡ä»¶</span><br><span class="line">$ sudo docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line"># Docker æŒ‚è½½æ•°æ®å·çš„é»˜è®¤æƒé™æ˜¯è¯»å†™ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ `:ro` æŒ‡å®šä¸ºåªè¯»ã€‚</span><br><span class="line">$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp:ro</span><br><span class="line">training/webapp python app.py</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šDockerfile ä¸­ä¸æ”¯æŒè¿™ç§ç”¨æ³•ï¼Œè¿™æ˜¯å› ä¸º Dockerfile æ˜¯ä¸ºäº†ç§»æ¤å’Œåˆ†äº«ç”¨çš„ã€‚ç„¶è€Œï¼Œä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„æ ¼å¼ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ç›®å‰è¿˜ä¸èƒ½æ”¯æŒã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VOLUME /data</span><br></pre></td></tr></table></figure>
<h2 id="Network-ç½‘ç»œ"><a href="#Network-ç½‘ç»œ" class="headerlink" title="Network | ç½‘ç»œ"></a>Network | ç½‘ç»œ</h2><p>Linux åœ¨ç½‘ç»œæ ˆä¸­å¼•å…¥ç½‘ç»œå‘½åç©ºé—´ï¼Œå°†ç‹¬ç«‹çš„ç½‘ç»œåè®®æ ˆéš”ç¦»åˆ°ä¸åŒçš„å‘½ä»¤ç©ºé—´ä¸­ï¼Œå½¼æ­¤é—´æ— æ³•é€šä¿¡ï¼›Docker åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå®ç°ä¸å®¹å™¨é—´çš„ç½‘ç»œéš”ç¦»ï¼Œå¹¶ä¸”å¼•å…¥ Veth è®¾å¤‡å¯¹æ¥å®ç°åœ¨ä¸åŒç½‘ç»œå‘½åç©ºé—´çš„é€šä¿¡ã€‚Linux ç³»ç»ŸåŒ…å«ä¸€ä¸ªå®Œæ•´çš„è·¯ç”±åŠŸèƒ½ï¼Œå½“ IP å±‚åœ¨å¤„ç†æ•°æ®å‘é€æˆ–è½¬å‘çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨è·¯ç”±è¡¨æ¥å†³å®šå‘å¾€å“ªé‡Œã€‚Netfilter è´Ÿè´£åœ¨å†…æ ¸ä¸­æ‰§è¡Œå„ç§æŒ‚æ¥çš„è§„åˆ™ (è¿‡æ»¤ã€ä¿®æ”¹ã€ä¸¢å¼ƒç­‰)ï¼Œè¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸­ï¼›Iptables æ¨¡å¼æ˜¯åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œçš„è¿›ç¨‹ï¼Œè´Ÿè´£ååŠ©ç»´æŠ¤å†…æ ¸ä¸­ Netfilter çš„å„ç§è§„åˆ™è¡¨ï¼›é€šè¿‡äºŒè€…çš„é…åˆæ¥å®ç°æ•´ä¸ª Linux ç½‘ç»œåè®®æ ˆä¸­çµæ´»çš„æ•°æ®åŒ…å¤„ç†æœºåˆ¶ã€‚Docker çš„ç½‘ç»œå­ç³»ç»Ÿé‡‡ç”¨äº†åŸºäºé©±åŠ¨çš„å¯æ’æ‹”æœºåˆ¶ï¼Œå…¶é»˜è®¤åŒ…å«äº†å¦‚ä¸‹é©±åŠ¨æ¨¡å¼ï¼š</p>
<ul>
<li><code>bridge</code>: é»˜è®¤çš„ç½‘ç»œé©±åŠ¨ï¼Œå¸¸ç”¨äºå¤šä¸ªåº”ç”¨è¿è¡Œä¸ç‹¬ç«‹å®¹å™¨ä¸­å¹¶ä¸”éœ€è¦ç›¸äº’é€šè®¯çš„æ—¶å€™ã€‚</li>
<li><code>host</code>: ç§»é™¤å®¹å™¨ä¸ Docker ä¸»æœºä¹‹é—´çš„ç½‘ç»œéš”ç¦»ï¼Œç›´æ¥ä½¿ç”¨å®¿ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œã€‚åº•å±‚ä¸å®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª Network Namespaceï¼Œå®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IP ç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚</li>
<li><code>overlay</code>: Overlay ç½‘ç»œç”¨è¯­è¿æ¥å¤šä¸ª Docker Daemonï¼Œä¿è¯ Docker Swarm æœåŠ¡çš„æ­£å¸¸è¿è¡Œï¼›ç‹¬ç«‹çš„å®¹å™¨ä¸ Swarm æœåŠ¡ï¼Œæˆ–è€…ä¸åŒå®¿ä¸»æœºä¸Šçš„å®¹å™¨åŒæ ·èƒ½å¤Ÿé€šè¿‡ Overlay è¿›è¡Œé€šä¿¡ã€‚</li>
<li><code>none</code>: å¯¹äºæŒ‡å®šå®¹å™¨ç¦æ­¢æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ã€‚</li>
<li><code>macvlan</code>: Macvlan ç½‘ç»œä¼šå…è®¸ç›´æ¥ä¸ºå®¹å™¨åˆ†é… MAC åœ°å€ï¼Œä½¿å…¶ä½œä¸ºçœŸæ­£çš„ç‰©ç†è®¾å¤‡æ¥å…¥åˆ°å®¿ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œä¸­ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä½¿ç”¨ network å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°é»˜è®¤çš„ç½‘ç»œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">f707aa0ef50d        bridge              bridge              local</span><br><span class="line">97dd7a032d96        host                host                local</span><br><span class="line">d5a1bed0b12d        none                null                local</span><br></pre></td></tr></table></figure>
<p>æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œå½“ Docker å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª docker0 è™šæ‹Ÿç½‘æ¡¥ï¼Œå³è½¯ä»¶äº¤æ¢æœºï¼Œåœ¨æŒ‚è½½åˆ°å®ƒçš„ç½‘å£ä¹‹é—´è¿›è¡Œè½¬å‘ã€‚åŒæ—¶ï¼ŒDocker éšæœºåˆ†é…ä¸€ä¸ªæœ¬åœ°æœªå ç”¨çš„ç§æœ‰ç½‘æ®µ (åœ¨ RFC1918 ä¸­å®šä¹‰) ä¸­çš„ä¸€ä¸ªåœ°å€ç»™ docker0 æ¥å£ã€‚æ¯”å¦‚å…¸å‹çš„ 172.17.42.1 ï¼Œæ©ç ä¸º 255.255.0.0 ã€‚æ­¤åå¯åŠ¨çš„å®¹å™¨å†…çš„ç½‘å£ä¹Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåŒä¸€ç½‘æ®µ ( 172.17.0.0/16) çš„åœ°å€ã€‚</p>
<p>æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª Docker å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºäº†ä¸€å¯¹ veth pair æ¥å£ (å½“æ•°æ®åŒ…å‘é€åˆ°ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥æ”¶åˆ°ç›¸åŒçš„æ•°æ®åŒ…)ã€‚è¿™å¯¹æ¥å£ä¸€ç«¯åœ¨å®¹å™¨å†…ï¼Œå³ eth0 ï¼›å¦ä¸€ç«¯åœ¨æœ¬åœ°å¹¶è¢«æŒ‚è½½åˆ° docker0 ç½‘æ¡¥ï¼Œåç§°ä»¥ veth å¼€å¤´ (ä¾‹å¦‚ vethAQI2QT)ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸»æœºå¯ä»¥è·Ÿå®¹å™¨é€šä¿¡ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’é€šä¿¡ã€‚Docker å°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´ä¸€ä¸ªè™šæ‹Ÿå…±äº«ç½‘ç»œã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> åˆ›å»ºæ–°çš„ç½‘ç»œ</span><br><span class="line"><span class="meta">$</span> docker network create --driver bridge isolated</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æŒ‡å®šç½‘æ®µï¼Œå®¿ä¸»æœºä¼šä½œä¸ºé»˜è®¤ç½‘å…³</span><br><span class="line"><span class="meta">$</span> docker network create --driver=bridge --subnet=192.168.2.0/24 --gateway=192.168.2.10 new_subnet</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ›å»ºæ—¶å°†æŸä¸ªå®¹å™¨è¿æ¥åˆ°ç½‘ç»œ</span><br><span class="line"><span class="meta">$</span> docker run --network=isolated -itd --name=docker-nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å°†æŸä¸ªè¿è¡Œä¸­å®¹å™¨è¿æ¥åˆ°æŸä¸ªç½‘ç»œ</span><br><span class="line"><span class="meta">$</span> docker network connect multi-host-network container1</span><br></pre></td></tr></table></figure>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä» Docker å®ˆæŠ¤è¿›ç¨‹ç»§æ‰¿ DNS è®¾ç½®ï¼ŒåŒ…æ‹¬ /etc/hosts å’Œ /etc/resolv.confã€‚å¯ä»¥åŸºäºæ¯ä¸ªå®¹å™¨è¦†ç›–è¿™äº›è®¾ç½®ã€‚</p>
<ul>
<li>-h HOSTNAME or â€“hostname=HOSTNAME è®¾å®šå®¹å™¨çš„ä¸»æœºåï¼Œå®ƒä¼šè¢«å†™åˆ°å®¹å™¨å†…çš„ /etc/hostname å’Œ /etc/hosts ã€‚ä½†å®ƒåœ¨å®¹å™¨å¤–éƒ¨çœ‹ä¸åˆ°ï¼Œæ—¢ä¸ä¼šåœ¨ docker ps ä¸­æ˜¾ç¤ºï¼Œä¹Ÿä¸ä¼šåœ¨å…¶ä»–çš„å®¹å™¨çš„ /etc/hosts çœ‹åˆ°ã€‚</li>
<li>â€“link=CONTAINER_NAME:ALIAS é€‰é¡¹ä¼šåœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œæ·»åŠ ä¸€ä¸ªå…¶ä»–å®¹å™¨çš„ä¸»æœºååˆ° /etc/hosts æ–‡ä»¶ä¸­ï¼Œè®©æ–°å®¹å™¨çš„è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¸»æœºå ALIAS å°±å¯ä»¥è¿æ¥å®ƒã€‚</li>
<li>â€“dns=IP_ADDRESS æ·»åŠ  DNS æœåŠ¡å™¨åˆ°å®¹å™¨çš„ /etc/resolv.conf ä¸­ï¼Œè®©å®¹å™¨ç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥è§£ææ‰€æœ‰ä¸åœ¨ /etc/hosts ä¸­çš„ä¸»æœºåã€‚</li>
<li>â€“dns-search=DOMAIN è®¾å®šå®¹å™¨çš„æœç´¢åŸŸï¼Œå½“è®¾å®šæœç´¢åŸŸä¸º .example.com æ—¶ï¼Œåœ¨æœç´¢ä¸€ä¸ªåä¸º host çš„ ä¸»æœºæ—¶ï¼ŒDNS ä¸ä»…æœç´¢ hostï¼Œè¿˜ä¼šæœç´¢ <a href="https://link.juejin.im?target=http%3A%2F%2Fhost.example.com" target="_blank" rel="noopener">host.example.com</a> ã€‚ æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰ä¸Šè¿°æœ€å 2 ä¸ªé€‰é¡¹ï¼Œ Docker ä¼šé»˜è®¤ç”¨ä¸»æœºä¸Šçš„ /etc/resolv.conf æ¥é…ç½®å®¹å™¨ã€‚</li>
</ul>
<h2 id="ç©ºé—´æ¸…ç†"><a href="#ç©ºé—´æ¸…ç†" class="headerlink" title="ç©ºé—´æ¸…ç†"></a>ç©ºé—´æ¸…ç†</h2><p>Docker ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç°å®¿ä¸»èŠ‚ç‚¹çš„ç£ç›˜å®¹é‡æŒç»­å¢é•¿ï¼Œè­¬å¦‚ volume æˆ–è€… overlay2 ç›®å½•å ç”¨äº†å¤§é‡çš„ç©ºé—´ï¼›å¦‚æœä»»å…¶å‘å±•ï¼Œå¯èƒ½å°†ç£ç›˜ç©ºé—´è€—å°½è¿›è€Œå¼•å‘å®¿ä¸»æœºå¼‚å¸¸ï¼Œè¿›è€Œå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚Docker çš„å†…ç½® df æŒ‡ä»¤å¯ç”¨äºæŸ¥è¯¢é•œåƒ (Images)ã€å®¹å™¨(Containers) å’Œæœ¬åœ°å· (Local Volumes) ç­‰ç©ºé—´ä½¿ç”¨å¤§æˆ·çš„ç©ºé—´å ç”¨æƒ…å†µã€‚è€Œå®¹å™¨çš„å ç”¨çš„æ€»ç©ºé—´ï¼ŒåŒ…å«å…¶æœ€é¡¶å±‚çš„è¯»å†™å±‚ (writable layer) å’Œåº•éƒ¨çš„åªè¯»é•œåƒå±‚(base image layerï¼Œread-only)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>ps -s</code> å‚æ•°æ¥æ˜¾ç¤ºäºŒè€…çš„ç©ºé—´å ç”¨æƒ…å†µ:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ç©ºé—´å ç”¨</span><br><span class="line"><span class="meta">$</span> du -h --max-depth=1 | sort</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç©ºé—´å ç”¨æ€»ä½“åˆ†æ</span><br><span class="line"><span class="meta">$</span> docker system df</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> è¾“å‡ºç©ºé—´å ç”¨ç»†èŠ‚</span><br><span class="line"><span class="meta">$</span> docker system df -v</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> è¾“å‡ºå®¹å™¨çš„ç©ºé—´å ç”¨</span><br><span class="line"><span class="meta">$</span> docker ps -s</span><br></pre></td></tr></table></figure>
<p><code>docker system prune</code> æŒ‡ä»¤èƒ½å¤Ÿè¿›è¡Œè‡ªåŠ¨åœ°ç©ºé—´æ¸…ç†ï¼Œå…¶é»˜è®¤ä¼šæ¸…é™¤å·²åœæ­¢çš„å®¹å™¨ã€æœªè¢«ä»»ä½•å®¹å™¨æ‰€ä½¿ç”¨çš„å·ã€æœªè¢«ä»»ä½•å®¹å™¨æ‰€å…³è”çš„ç½‘ç»œã€æ‰€æœ‰æ‚¬ç©ºé•œåƒ:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ä¸€å¹¶æ¸…é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒå’Œæ‚¬ç©ºé•œåƒ</span><br><span class="line"><span class="meta">$</span> docker system prune --all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ—ä¸¾æ‚¬ç©ºé•œåƒ</span><br><span class="line"><span class="meta">$</span> docker images -f dangling=true</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤å…¨éƒ¨æ‚¬ç©ºé•œåƒ</span><br><span class="line"><span class="meta">$</span> docker image prune</span><br><span class="line"><span class="meta">#</span> åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker image prune -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤æŒ‡å®šæ¨¡å¼çš„é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker images -a | grep "pattern" | awk '&#123;print $3&#125;' | xargs docker rmi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤å…¨éƒ¨é•œåƒ</span><br><span class="line"><span class="meta">$</span> docker rmi $(docker images -a -q)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤å…¨éƒ¨åœæ­¢çš„å®¹å™¨</span><br><span class="line"><span class="meta">$</span> docker rm $(docker ps -a -f status=exited -q)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ ¹æ®æŒ‡å®šæ¨¡å¼åˆ é™¤å®¹å™¨</span><br><span class="line"><span class="meta">$</span> docker rm $(docker ps -a -f status=exited -f status=created -q)</span><br><span class="line"><span class="meta">$</span> docker rm $(docker ps -a | grep rabbitmq | awk '&#123;print $1&#125;')</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤å…¨éƒ¨å®¹å™¨</span><br><span class="line"><span class="meta">$</span> docker stop $(docker ps -a -q)</span><br><span class="line"><span class="meta">$</span> docker rm $(docker ps -a -q)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ—ä¸¾å¹¶åˆ é™¤æœªè¢«ä½¿ç”¨çš„å·</span><br><span class="line"><span class="meta">$</span> docker volume ls -f dangling=true</span><br><span class="line"><span class="meta">$</span> docker volume prune</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ ¹æ®æŒ‡å®šçš„æ¨¡å¼åˆ é™¤å·</span><br><span class="line"><span class="meta">$</span> docker volume prune --filter "label!=keep"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤æœªè¢«å…³è”çš„ç½‘ç»œ</span><br><span class="line"><span class="meta">$</span> docker network prune</span><br><span class="line"><span class="meta">$</span> docker network prune --filter "until=24h"</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å°ºå¯¸æˆ–è€…æ¸…ç©ºæ—¥å¿—æ–‡ä»¶:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> è®¾ç½®æ—¥å¿—æ–‡ä»¶æœ€å¤§å°ºå¯¸</span><br><span class="line"><span class="meta">$</span> dockerd ... --log-opt max-size=10m --log-opt max-file=3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ¸…ç©ºå½“å‰æ—¥å¿—æ–‡ä»¶</span><br><span class="line">truncate -s 0 /var/lib/docker/containers/*/*-json.log</span><br></pre></td></tr></table></figure>
<h1 id="æœåŠ¡æ²»ç†"><a href="#æœåŠ¡æ²»ç†" class="headerlink" title="æœåŠ¡æ²»ç†"></a>æœåŠ¡æ²»ç†</h1><h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><p>Docker Compose æ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤æ‚ Docker åº”ç”¨çš„å·¥å…·ã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨çš„åº”ç”¨ï¼Œç„¶åä½¿ç”¨ä¸€æ¡å‘½ä»¤æ¥å¯åŠ¨ä½ çš„åº”ç”¨ï¼Œç„¶åæ‰€æœ‰ç›¸å…³çš„æ“ä½œéƒ½ä¼šè¢«è‡ªåŠ¨å®Œæˆï¼›ç®€å•çš„ Compose æ–‡ä»¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æŒ‡å®š Docker Compose æ–‡ä»¶ç‰ˆæœ¬</span><br><span class="line">version: '3'</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    # æŒ‡å®šä»æœ¬åœ°ç›®å½•è¿›è¡Œç¼–è¯‘</span><br><span class="line">    build: .</span><br><span class="line"></span><br><span class="line">    # æŒ‡å®šå¯¼å‡ºç«¯å£</span><br><span class="line">    ports:</span><br><span class="line">      - '5000:5000'</span><br><span class="line"></span><br><span class="line">    # æ›¿æ¢é»˜è®¤çš„ CMD å‘½ä»¤</span><br><span class="line">    command: python app.py</span><br><span class="line"></span><br><span class="line">    # å°†æœ¬åœ°ç›®å½•ç»‘å®šåˆ°å®¹å™¨å†…ç›®å½•</span><br><span class="line">    volumes:</span><br><span class="line">      - .:/code</span><br><span class="line"></span><br><span class="line">  redis:</span><br><span class="line">    # é•œåƒçš„ ID</span><br><span class="line">    image: 'redis:alpine'</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨åˆ°çš„ Python Web åº”ç”¨çš„ Dockerfile å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM python:3.4-alpine</span><br><span class="line">ADD . /code</span><br><span class="line">WORKDIR /code</span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line">CMD ["python", "app.py"]</span><br></pre></td></tr></table></figure>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨æœåŠ¡åä½œä¸ºè¿æ¥åœ°å€ï¼Œå³å¯è®¿é—®åˆ° Redis æ•°æ®åº“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cache = redis.Redis(host=&apos;redis&apos;, port=6379)</span><br></pre></td></tr></table></figure>
<p>ç„¶åä½¿ç”¨ docker-compose å‘½ä»¤å¯åŠ¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> äº¤äº’å¼å¯åŠ¨</span><br><span class="line"><span class="meta">$</span> docker-compose up</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å®ˆæŠ¤è¿›ç¨‹å¼å¯åŠ¨</span><br><span class="line"><span class="meta">$</span> docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æŸ¥çœ‹è¿è¡Œæƒ…å†µ</span><br><span class="line"><span class="meta">$</span> docker-compose ps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> å…³é—­</span><br><span class="line"><span class="meta">$</span> docker-compose stop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç§»é™¤å†…éƒ¨å·</span><br><span class="line"><span class="meta">$</span> docker-compose down --volumes</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¶‰åŠåˆ°æ•°æ®å­˜å‚¨çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æŒ‡å®š docker-compose åˆ›å»ºå‘½åæ•°æ®å·ï¼Œå¹¶å°†å…¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">version: "3.2"</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    volumes:</span><br><span class="line">      - type: volume</span><br><span class="line">        source: mydata</span><br><span class="line">        target: /data</span><br><span class="line">        volume:</span><br><span class="line">          nocopy: true</span><br><span class="line">      - type: bind</span><br><span class="line">        source: ./static</span><br><span class="line">        target: /opt/app/static</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: postgres:latest</span><br><span class="line">    volumes:</span><br><span class="line">      - "/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock"</span><br><span class="line">      - "dbdata:/var/lib/postgresql/data"</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mydata:</span><br><span class="line">  dbdata:</span><br></pre></td></tr></table></figure>
<h2 id="Docker-Swarm-1"><a href="#Docker-Swarm-1" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h2><p>Swarm æ˜¯ Docker å…¬å¸åœ¨ 2014 å¹´ 12 æœˆåˆå‘å¸ƒçš„ä¸€å¥—è¾ƒä¸ºç®€å•çš„å·¥å…·ï¼Œç”¨æ¥ç®¡ç† Docker é›†ç¾¤ï¼Œå®ƒå°†ä¸€ç¾¤ Docker å®¿ä¸»æœºå˜æˆä¸€ä¸ªå•ä¸€çš„ï¼Œè™šæ‹Ÿçš„ä¸»æœºã€‚Swarm ä½¿ç”¨æ ‡å‡†çš„ Docker API æ¥å£ä½œä¸ºå…¶å‰ç«¯è®¿é—®å…¥å£ï¼Œæ¢è¨€ä¹‹ï¼Œå„ç§å½¢å¼çš„ Docker Client(dockerclient in go, docker_py, docker ç­‰) å‡å¯ä»¥ç›´æ¥ä¸ Swarm é€šä¿¡ã€‚</p>
<p>Swarm Deamon åªæ˜¯ä¸€ä¸ªè°ƒåº¦å™¨ (Scheduler) å’Œè·¯ç”±å™¨ (Router)ï¼ŒSwarm è‡ªå·±ä¸è¿è¡Œå®¹å™¨ï¼Œå®ƒåªæ˜¯æ¥å— Docker å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œè°ƒåº¦é€‚åˆçš„èŠ‚ç‚¹æ¥è¿è¡Œå®¹å™¨ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä½¿ Swarm ç”±äºæŸäº›åŸå› æŒ‚æ‰äº†ï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹Ÿä¼šç…§å¸¸è¿è¡Œï¼Œå½“ Swarm é‡æ–°æ¢å¤è¿è¡Œä¹‹åï¼Œå®ƒä¼šæ”¶é›†é‡å»ºé›†ç¾¤ä¿¡æ¯ã€‚å¹¶ä¸” Swarm æä¾›çš„è·¯ç”±åŒ¹é…(æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€è·¨å®¹å™¨é€šè®¯) éå¸¸å¯é ã€‚åœ¨å•ä¸ªç«¯å£ä¸Šè¿è¡Œä¸€ä¸ªæœåŠ¡ï¼ŒSwarm èŠ‚ç‚¹çš„ä»»æ„ä¸»æœºéƒ½å¯ä»¥è®¿é—®ï¼Œè´Ÿè½½å‡è¡¡å®Œå…¨åœ¨åå°å®ç°ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/9/18/165ed623f124b15d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p>
<p>Swarm åœ¨ Scheduler èŠ‚ç‚¹è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥æ¥è®¡ç®—æœ€é€‚åˆè¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ï¼Œç›®å‰æ”¯æŒçš„ç­–ç•¥æœ‰ï¼šRandom, Binpack, Spreadã€‚</p>
<p>Random é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯éšæœºé€‰æ‹©ä¸€ä¸ª Node æ¥è¿è¡Œå®¹å™¨ï¼Œä¸€èˆ¬ç”¨ä½œè°ƒè¯•ç”¨ã€‚Spread å’Œ Binpack ç­–ç•¥ä¼šæ ¹æ®å„ä¸ªèŠ‚ç‚¹çš„å¯ç”¨çš„ CPU, RAM ä»¥åŠæ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„æ•°é‡æ¥è®¡ç®—åº”è¯¥è¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ã€‚åœ¨åŒç­‰æ¡ä»¶ä¸‹ï¼ŒSpread ç­–ç•¥ä¼šé€‰æ‹©è¿è¡Œå®¹å™¨æœ€å°‘çš„é‚£å°èŠ‚ç‚¹æ¥è¿è¡Œæ–°çš„å®¹å™¨ï¼Œbinpack ç­–ç•¥ä¼šé€‰æ‹©è¿è¡Œå®¹å™¨æœ€é›†ä¸­çš„é‚£å°æœºå™¨æ¥è¿è¡Œæ–°çš„èŠ‚ç‚¹ã€‚</p>
<p>ä½¿ç”¨ Spread ç­–ç•¥ä¼šä½¿å¾—å®¹å™¨ä¼šå‡è¡¡çš„åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä¸€æ—¦ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†åªä¼šæŸå¤±å°‘éƒ¨åˆ†çš„å®¹å™¨ã€‚Binpack ç­–ç•¥æœ€å¤§åŒ–çš„é¿å…å®¹å™¨ç¢ç‰‡åŒ–ï¼Œå°±æ˜¯è¯´ Binpack ç­–ç•¥å°½å¯èƒ½çš„æŠŠè¿˜æœªä½¿ç”¨çš„èŠ‚ç‚¹ç•™ç»™éœ€è¦æ›´å¤§ç©ºé—´çš„å®¹å™¨è¿è¡Œï¼Œå°½å¯èƒ½çš„æŠŠå®¹å™¨è¿è¡Œåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡</span><br><span class="line"><span class="meta">$</span> docker service create \</span><br><span class="line">--image nginx \</span><br><span class="line">--replicas 2 \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ›´æ–°æœåŠ¡</span><br><span class="line"><span class="meta">$</span> docker service update \</span><br><span class="line">--image nginx:alpine \</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ é™¤æœåŠ¡</span><br><span class="line"><span class="meta">$</span> docker service rm nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç¼©å®¹ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ é™¤æœåŠ¡</span><br><span class="line"><span class="meta">$</span> docker service scale nginx=0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ‰©å®¹</span><br><span class="line"><span class="meta">$</span> docker service scale nginx=5</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ—å‡ºæ‰€æœ‰çš„æœåŠ¡</span><br><span class="line"><span class="meta">$</span> docker service ls</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ—å‡ºä¸€ä¸ªæœåŠ¡çš„æ‰€æœ‰å®ä¾‹(åŒ…æ‹¬æœåŠ¡çš„å¥åº·çŠ¶å†µ)</span><br><span class="line"><span class="meta">$</span> docker service ps nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line"><span class="meta">$</span> docker service inspect nginx</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Docker Compose çš„è„šæœ¬æ¥è¿›è¡Œæ‰¹æ¬¡éƒ¨ç½²ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> docker stack deploy application</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: '3'</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: registry.gitlab.com/example/example # you need to use external image</span><br><span class="line">    command: npm run prod</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 6</span><br><span class="line">      update_config:</span><br><span class="line">        parallelism: 2</span><br><span class="line">        delay: 10s</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br></pre></td></tr></table></figure>
<h1 id="Further-Reading"><a href="#Further-Reading" class="headerlink" title="Further Reading"></a>Further Reading</h1><ul>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fwxyyxc1992%2FInfraS-Lab" target="_blank" rel="noopener">InfraS-Lab/Focker</a>: ä»¿ Docker è½»é‡çº§å®ç°</p>
</li>
<li><p><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fwxyyxc1992%2FDistributed-Infrastructure-Series" target="_blank" rel="noopener">æ·±å…¥æµ…å‡ºåˆ†å¸ƒå¼åŸºç¡€æ¶æ„</a>ã€‚</p>
</li>
<li><p><a href="https://link.juejin.im?target=.%2FKubernetes-CheatSheet.md" target="_blank" rel="noopener">Kubernetes CheatSheet</a>: Kubernetes åŸºç¡€æ¦‚å¿µï¼Œé…ç½®ä½¿ç”¨ä¸å®è·µæŠ€å·§</p>
</li>
</ul>

      
    </div>
    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------æœ¬æ–‡ç»“æŸ<i class="fa fa-paw"></i>æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------</div>
    
</div>

      
    </div>

    

    

        

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/bugs/tags/docker/" rel="tag"><i class="fa fa-tag"></i> docker</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/bugs/2018/09/19/è¯­è¨€/Java/è¯¦ç»†é¢†æ‚Ÿ ThreadLocal å˜é‡/" rel="next" title="è¯¦ç»†é¢†æ‚ŸThreadLocal">
                <i class="fa fa-chevron-left"></i> è¯¦ç»†é¢†æ‚ŸThreadLocal
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/bugs/2018/09/20/ç®—æ³•/äºŒåˆ†æ³•æ’åº/" rel="prev" title="äºŒåˆ†æ³•æ’åº">
                äºŒåˆ†æ³•æ’åº <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Dean Wang</p>
              <p class="site-description motion-element" itemprop="description">Java Python å¤§æ•°æ®</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/bugs/archives/">
              
                  <span class="site-state-item-count">60</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/bugs/categories/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/bugs/tags/index.html">
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/deanwang1943" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:wangjingxin1986@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-CheatSheet-Docker-é…ç½®ä¸å®è·µæ¸…å•"><span class="nav-number">1.</span> <span class="nav-text">Docker CheatSheet | Docker é…ç½®ä¸å®è·µæ¸…å•</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å®‰è£…ä¸é…ç½®"><span class="nav-number">2.</span> <span class="nav-text">å®‰è£…ä¸é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-CE"><span class="nav-number">2.1.</span> <span class="nav-text">Docker CE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Daemon-Configuration"><span class="nav-number">2.2.</span> <span class="nav-text">Daemon Configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-Swarm"><span class="nav-number">2.3.</span> <span class="nav-text">Docker Swarm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»£ç†è®¾ç½®"><span class="nav-number">2.4.</span> <span class="nav-text">ä»£ç†è®¾ç½®</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#é•œåƒ"><span class="nav-number">3.</span> <span class="nav-text">é•œåƒ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ„å»ºä¸æ‹‰å–"><span class="nav-number">3.1.</span> <span class="nav-text">æ„å»ºä¸æ‹‰å–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é•œåƒç®¡ç†"><span class="nav-number">3.2.</span> <span class="nav-text">é•œåƒç®¡ç†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockfile"><span class="nav-number">3.3.</span> <span class="nav-text">Dockfile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Registry"><span class="nav-number">3.4.</span> <span class="nav-text">Registry</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å®¹å™¨"><span class="nav-number">4.</span> <span class="nav-text">å®¹å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯åœæ§åˆ¶"><span class="nav-number">4.1.</span> <span class="nav-text">å¯åœæ§åˆ¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#çŠ¶æ€æŸ¥è¯¢"><span class="nav-number">4.2.</span> <span class="nav-text">çŠ¶æ€æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç®¡ç†é…ç½®"><span class="nav-number">4.3.</span> <span class="nav-text">ç®¡ç†é…ç½®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#èµ„æºé…é¢"><span class="nav-number">4.4.</span> <span class="nav-text">èµ„æºé…é¢</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory"><span class="nav-number">4.4.1.</span> <span class="nav-text">Memory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU"><span class="nav-number">4.4.2.</span> <span class="nav-text">CPU</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Storage"><span class="nav-number">4.4.3.</span> <span class="nav-text">Storage</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#èµ„æºé…ç½®"><span class="nav-number">5.</span> <span class="nav-text">èµ„æºé…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Volume-æ•°æ®å·"><span class="nav-number">5.1.</span> <span class="nav-text">Volume | æ•°æ®å·</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Network-ç½‘ç»œ"><span class="nav-number">5.2.</span> <span class="nav-text">Network | ç½‘ç»œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS"><span class="nav-number">5.2.1.</span> <span class="nav-text">DNS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç©ºé—´æ¸…ç†"><span class="nav-number">5.3.</span> <span class="nav-text">ç©ºé—´æ¸…ç†</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æœåŠ¡æ²»ç†"><span class="nav-number">6.</span> <span class="nav-text">æœåŠ¡æ²»ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-Compose"><span class="nav-number">6.1.</span> <span class="nav-text">Docker Compose</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-Swarm-1"><span class="nav-number">6.2.</span> <span class="nav-text">Docker Swarm</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Further-Reading"><span class="nav-number">7.</span> <span class="nav-text">Further Reading</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dean Wang</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/bugs/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/bugs/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/bugs/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/bugs/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/bugs/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/bugs/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/bugs/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/bugs/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/bugs/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/bugs/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/bugs/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
